
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Modelos estadísticos &#8212; Parcial</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Ejercicio2';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MODELO RNN" href="RNN.html" />
    <link rel="prev" title="Parcial 1 de Machine Learning" href="Ejercicio1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Parcial</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Parcial Series de tiempo
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Ejercicio1.html">Parcial 1 de Machine Learning</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Modelos estadísticos</a></li>



<li class="toctree-l1"><a class="reference internal" href="RNN.html">MODELO RNN</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Ejercicio2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Modelos estadísticos</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Modelos estadísticos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definicion-de-librerias-metricas-y-precision-del-modelo">Definición de librerias, métricas y precisión del modelo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pruebas-de-hipotesis-para-independencia-y-normalidad">Pruebas de hipótesis para independencia y normalidad</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento-validacion-y-test">Entrenamiento, Validación y Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carga-y-procesamiento-de-los-datos">Carga y Procesamiento de los Datos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelamiento-y-ajuste">Modelamiento y ajuste</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponential-smoothing-sin-libreria">Simple Exponential Smoothing (Sin Librería)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponential-smoothing-statsmodels">Simple Exponential Smoothing (Statsmodels)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing">Double Exponencial Smoothing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-con-libreria">Double Exponencial Smoothing (Con librería)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#test">TEST</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-sin-rolling">Arima (Sin Rolling)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento">ENTRENAMIENTO</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">TEST</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-con-rolling">Arima (Con Rolling)</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="modelos-estadisticos">
<h1>Modelos estadísticos<a class="headerlink" href="#modelos-estadisticos" title="Link to this heading">#</a></h1>
<p>En cada uno de los siguientes ejercicios considere los siguientes pasos para construir sus modelos
predictivos. Debe realizar este procedimiento para las series: precio, retorno acumulado y volatilidad
para las diferentes ventanas (ω = 7,14,21,28)</p>
<section id="definicion-de-librerias-metricas-y-precision-del-modelo">
<h2>Definición de librerias, métricas y precisión del modelo<a class="headerlink" href="#definicion-de-librerias-metricas-y-precision-del-modelo" title="Link to this heading">#</a></h2>
<p>Procedemos inicialmente a cargar las librerias a utilizar, definir las métricas, definir cálculo de residuales, R2, Prueba de Ljung-Box y prueba de Jarque - Bera</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa</span> <span class="kn">import</span> <span class="n">stattools</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">jarque_bera</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">autocorrelation_plot</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">SimpleExpSmoothing</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_percentage_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span> 
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">Holt</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_predict</span><span class="p">,</span> <span class="n">plot_acf</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">,</span> <span class="n">str_model</span><span class="p">,</span> <span class="n">lj_lags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">window_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>    <span class="c1"># MAPE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>                      <span class="c1"># MAE</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>                       <span class="c1"># MSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>                                           <span class="c1"># RMSE</span>
    
    <span class="c1"># Cálculo de los residuales</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">actual</span> <span class="o">-</span> <span class="n">forecast</span>

    <span class="c1"># Cálculo del R²</span>
    <span class="n">ss_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">actual</span> <span class="o">-</span> <span class="n">forecast</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ss_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">actual</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">ss_res</span> <span class="o">/</span> <span class="n">ss_tot</span><span class="p">)</span>
    
    <span class="c1"># Prueba de Ljung-Box</span>
    <span class="n">lb_test</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lj_lags</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">lb_pvalue</span> <span class="o">=</span> <span class="n">lb_test</span><span class="p">[</span><span class="s1">&#39;lb_pvalue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># p-valor en el lag máximo especificado (10 en este caso)</span>

    <span class="c1"># Prueba de Jarque-Bera</span>
    <span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_pvalue</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>

    <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">str_model</span><span class="p">,</span>
        <span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window_str</span><span class="p">,</span>
        <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
        <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
        <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
        <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">],</span>
        <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2</span><span class="p">],</span>
        <span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lb_pvalue</span><span class="p">],</span>
        <span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jb_pvalue</span><span class="p">]</span>
    <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">df_acc</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pruebas-de-hipotesis-para-independencia-y-normalidad">
<h2>Pruebas de hipótesis para independencia y normalidad<a class="headerlink" href="#pruebas-de-hipotesis-para-independencia-y-normalidad" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">nlags_ljbox</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Test de Independencia  Ljung-Box --------&#39;</span><span class="p">)</span>
  
    <span class="c1"># Ho: no hay autocorrelación en los residuos</span>
    <span class="n">acf_</span><span class="p">,</span> <span class="n">confint_</span><span class="p">,</span> <span class="n">qstat_</span><span class="p">,</span> <span class="n">pvalues_</span> <span class="o">=</span> <span class="n">stattools</span><span class="o">.</span><span class="n">acf</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">nlags_ljbox</span><span class="p">,</span> <span class="n">qstat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
  
    <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">p_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pvalues_</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p_val</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is accepted at lag = </span><span class="si">{}</span><span class="s1"> for p-val = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p_val</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is rejected at lag = </span><span class="si">{}</span><span class="s1"> for p-val = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p_val</span><span class="p">))</span>
  
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Test de Normalidad  Jarque-Bera --------&#39;</span><span class="p">)</span>

    <span class="c1"># Jarque-Bera</span>
    <span class="c1"># Ho: los residuos tienen distribución normal</span>
    <span class="n">JB</span><span class="p">,</span> <span class="n">JBpv</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">JBpv</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is accepted, residuos normales&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is rejected, residuos no normales&#39;</span><span class="p">)</span>

    <span class="c1"># Gráfico de la serie temporal de los residuos</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Grafico de serie de residuos --------&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Serie Temporal de los Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Q-Q Plot</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- QQ Plot --------&#39;</span><span class="p">)</span>
    <span class="n">qq</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">)</span>
    <span class="n">teoricos</span> <span class="o">=</span> <span class="n">qq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  
    <span class="n">observados</span> <span class="o">=</span> <span class="n">qq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> 

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">teoricos</span><span class="p">,</span> <span class="n">observados</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observados&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">teoricos</span><span class="p">,</span> <span class="n">teoricos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Línea de referencia&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot de los Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Teóricos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Observados&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- ACF de Residuos --------&#39;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF of Residuals&#39;</span><span class="p">)</span>
    <span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="entrenamiento-validacion-y-test">
<h2>Entrenamiento, Validación y Test<a class="headerlink" href="#entrenamiento-validacion-y-test" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
    <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

    <span class="c1"># Preparación de los datos</span>
    <span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span>
    <span class="p">})</span>
    <span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">val</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">val</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span>
    <span class="p">})</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span>
    <span class="p">})</span>
    <span class="n">y_pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Prediction&#39;</span>
    <span class="p">})</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">y_pred_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span>
        <span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Validation&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span>
    <span class="p">})</span>

    <span class="c1"># Cálculo MAE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Category&#39;</span><span class="p">,</span>
        <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;Dash&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">, MAE: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">mae</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color_discrete_map</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Validation&#39;</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">legend_title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">template</span><span class="o">=</span><span class="s1">&#39;plotly_white&#39;</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="k">def</span> <span class="nf">train_val_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
  <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">train_len</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">56</span> 
  <span class="n">val_set_end</span> <span class="o">=</span> <span class="n">train_len</span> <span class="o">+</span> <span class="n">window</span>
  <span class="n">test_set_end</span> <span class="o">=</span> <span class="n">val_set_end</span> <span class="o">+</span> <span class="n">window</span>
  

  <span class="n">train_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="n">train_len</span><span class="p">]</span>
  <span class="n">val_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">train_len</span><span class="p">:</span> <span class="n">val_set_end</span><span class="p">]</span>
  <span class="n">test_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">val_set_end</span><span class="p">:</span> <span class="n">test_set_end</span><span class="p">]</span>

  <span class="k">return</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">val_set</span><span class="p">,</span> <span class="n">test_set</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="carga-y-procesamiento-de-los-datos">
<h2>Carga y Procesamiento de los Datos<a class="headerlink" href="#carga-y-procesamiento-de-los-datos" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_init</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/lihkir/Data/refs/heads/main/Bitcoin%20Historical%20Data.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">data_init</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">]]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">timeserie</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Price&quot;</span><span class="p">]</span>

<span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>  <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="modelamiento-y-ajuste">
<h2>Modelamiento y ajuste<a class="headerlink" href="#modelamiento-y-ajuste" title="Link to this heading">#</a></h2>
<section id="simple-exponential-smoothing-sin-libreria">
<h3>Simple Exponential Smoothing (Sin Librería)<a class="headerlink" href="#simple-exponential-smoothing-sin-libreria" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definición de horizontes</span>

<span class="n">windows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>
<span class="n">model_summary</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># Función de Suavizado Exponencial Simple </span>
<span class="k">def</span> <span class="nf">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Empty training serie.&quot;</span><span class="p">)</span>
        
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">start</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Generar predicciones basadas en el último valor suavizado</span>
<span class="k">def</span> <span class="nf">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Aplicar SES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">firstsmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Empty training serie.&quot;</span><span class="p">)</span>
        
    <span class="n">last_smoothed</span> <span class="o">=</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">last_smoothed</span><span class="p">]</span> <span class="o">*</span> <span class="n">val_length</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador </span>
<span class="k">def</span> <span class="nf">ses_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
            <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mae</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="k">def</span> <span class="nf">ses_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">ses_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ENTRENAMIENTO</span>

<span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">ses_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">})</span>
    
<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE        MAPE          RMSE  \
train   SSE       7  32900.611982  1.236833e+09  13411.5969  35168.642882   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
train -4.377388                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/45ff17674e5b1b67c4434be92030009a59c0295d024ef5ea34b6109681ae71fd.png" src="_images/45ff17674e5b1b67c4434be92030009a59c0295d024ef5ea34b6109681ae71fd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/cf2395acdeaec00c89f02c02b29f018191ee2353260881501ae47e162253b131.png" src="_images/cf2395acdeaec00c89f02c02b29f018191ee2353260881501ae47e162253b131.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" src="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE        MAPE          RMSE  \
train   SSE      14  32900.611982  1.236833e+09  13411.5969  35168.642882   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
train -4.377388                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/45ff17674e5b1b67c4434be92030009a59c0295d024ef5ea34b6109681ae71fd.png" src="_images/45ff17674e5b1b67c4434be92030009a59c0295d024ef5ea34b6109681ae71fd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/cf2395acdeaec00c89f02c02b29f018191ee2353260881501ae47e162253b131.png" src="_images/cf2395acdeaec00c89f02c02b29f018191ee2353260881501ae47e162253b131.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" src="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE        MAPE          RMSE  \
train   SSE      21  32900.611982  1.236833e+09  13411.5969  35168.642882   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
train -4.377388                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/45ff17674e5b1b67c4434be92030009a59c0295d024ef5ea34b6109681ae71fd.png" src="_images/45ff17674e5b1b67c4434be92030009a59c0295d024ef5ea34b6109681ae71fd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/cf2395acdeaec00c89f02c02b29f018191ee2353260881501ae47e162253b131.png" src="_images/cf2395acdeaec00c89f02c02b29f018191ee2353260881501ae47e162253b131.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" src="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE        MAPE          RMSE  \
train   SSE      28  32900.611982  1.236833e+09  13411.5969  35168.642882   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
train -4.377388                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/45ff17674e5b1b67c4434be92030009a59c0295d024ef5ea34b6109681ae71fd.png" src="_images/45ff17674e5b1b67c4434be92030009a59c0295d024ef5ea34b6109681ae71fd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/cf2395acdeaec00c89f02c02b29f018191ee2353260881501ae47e162253b131.png" src="_images/cf2395acdeaec00c89f02c02b29f018191ee2353260881501ae47e162253b131.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" src="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" />
</div>
</div>
<p>Para evaluar la eficacia del modelo de suavización exponencial en el conjunto de entrenamiento, se examinaron diferentes métricas de error:</p>
<ol class="arabic simple">
<li><p><em>Error Absoluto Medio (MAE):</em> Con un valor cercano a 32,9, el MAE indica la magnitud promedio del error absoluto entre los valores reales y las predicciones generadas por el modelo. Este resultado implica la media de la desviación en unidades de la serie temporal.</p></li>
<li><p><em>Error Cuadrático Medio (MSE):</em> Con un valor significativamente alto, el MSE sugiere una alta variabilidad en los errores. Este indicador es particularmente sensible a errores grandes, ya que eleva al cuadrado las desviaciones, aumentando la penalización en casos de errores más sustanciales.</p></li>
<li><p><em>Raíz del Error Cuadrático Medio (RMSE):</em> Con un valor de 35,18, el RMSE brinda una medida de la desviación estándar de los errores.</p></li>
<li><p><em>Error Porcentual Absoluto Medio (MAPE):</em> Con un MAPE de 13,41 %, se presenta un error porcentual promedio considerable. Esto señala que el modelo tiene una precisión limitada en la serie temporal, particularmente en instantes donde los valores reales muestran alta variabilidad.</p></li>
</ol>
<p><strong>Para validar la adecuación de los residuos generados por el modelo de suavización exponencial, se implementaron dos pruebas estadísticas esenciales:</strong></p>
<ul class="simple">
<li><p>Prueba de Ljung-Box: Esta prueba investiga la independencia de los residuos. Los resultados revelan que se rechaza la hipótesis nula de independencia en los primeros 10 rezagos, con un valor p de 0.0 en cada caso. Esto indica una autocorrelación significativa en los residuos, sugiriendo que el modelo no captura completamente las dependencias temporales presentes en la serie.</p></li>
<li><p>Prueba de Normalidad de Jarque-Bera: Se utiliza esta prueba para confirmar si los residuos se distribuyen normalmente. Con un valor p de 0.0, se rechaza la hipótesis nula de normalidad, lo que implica que los residuos no siguen una distribución normal. Este resultado puede indicar un déficit en la captura de ciertos patrones en los datos.</p></li>
</ul>
<p><strong>Los gráficos obtenidos proporcionan información adicional sobre el comportamiento de los residuos del modelo:</strong></p>
<ul class="simple">
<li><p>Serie Temporal de Residuos: La gráfica representa las fluctuaciones y variaciones notables en los residuos a lo largo del tiempo. En algunos momentos, se aprecian desviaciones abruptas, sugiriendo que hay eventos o patrones que el modelo de suavización exponencial no logra captar adecuadamente.</p></li>
<li><p>Gráfico Q-Q de Residuos: Este gráfico pone de manifiesto que los residuos se desvían considerablemente de la línea teórica de normalidad, en particular en los extremos. Este hallazgo respalda la conclusión de la prueba de Jarque-Bera, evidenciando que los residuos no siguen una distribución normal.</p></li>
<li><p>Función de Autocorrelación (ACF) de Residuos: La ACF revela una clara tendencia de autocorrelación positiva en los primeros rezagos, aunque disminuye gradualmente. No obstante, algunos picos que se encuentran fuera de los intervalos de confianza sugieren que persisten patrones en los residuos que no han sido adecuadamente modelados.</p></li>
<li><p>En conclusión, los resultados sugieren que el modelo de suavización exponencial enfrenta limitaciones para capturar completamente los patrones temporales de la serie, lo cual se refleja en los altos valores de error y la falla de las pruebas de independencia y normalidad aplicadas a los residuos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TEST</span>

<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE       R2  \
test   SSE       7  2839.335976  1.242245e+07  0.060405  3524.549638 -1.84878   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.009841               0.6969  
(7, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      14  3332.601755  1.168448e+07  0.064547  3418.256446   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -19.206875            0.47835             0.137768  
(14, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE          RMSE  \
test   SSE      21  8005.921852  1.041354e+08  0.123616  10204.676767   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -1.319757       4.509490e-10             0.328286  
(21, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE          RMSE  \
test   SSE      28  14136.84777  2.180818e+08  0.211357  14767.593779   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -10.961906           0.000002             0.427015  
(28, 1)
</pre></div>
</div>
</div>
</div>
<p>En el análisis del conjunto de pruebas para el modelo de suavización exponencial utilizando diferentes tamaños de ventana, se identifican los siguientes patrones:</p>
<ul class="simple">
<li><p>Ventana de 7:</p></li>
</ul>
<p>Las métricas de error son relativamente bajas en comparación con otros tamaños de ventana, lo que sugiere un mejor rendimiento en términos de error absoluto y cuadrático.
El coeficiente de determinación ( R^2 ) presenta un valor negativo, lo que indica una capacidad explicativa limitada del modelo en este conjunto de pruebas.
La prueba de Ljung-Box no permite rechazar la hipótesis de independencia de los residuos, lo cual es positivo para la validez del modelo.
La prueba de Jarque-Bera no rechaza la normalidad de los residuos, indicando un comportamiento razonablemente adecuado en términos de distribución.</p>
<ul class="simple">
<li><p>Ventana de 14:</p></li>
</ul>
<p>Las métricas de error aumentan en comparación con la ventana de 7, sugiriendo una disminución en la precisión del ajuste.
El valor de ( R^2 ) permanece negativo, evidenciando una falta de ajuste adecuado.
La prueba de Ljung-Box muestra un valor p más bajo, acercándose a umbrales que podrían indicar correlación en los residuos, aunque no es concluyente.
La prueba de Jarque-Bera sigue sin rechazar la normalidad, lo que sugiere que los residuos mantienen una distribución aceptable.</p>
<ul class="simple">
<li><p>Ventana de 21:</p></li>
</ul>
<p>Las métricas de error mejoran ligeramente en comparación con la ventana de 14, aunque siguen siendo más altas que las de la ventana de 7.
El ( R^2 ) continúa siendo negativo, pero experimenta una mejora con respecto a la ventana anterior.
La prueba de Ljung-Box presenta un valor p menor, acercándose a un rango de rechazo, lo que podría sinalar posible autocorrelación en los residuos.
La prueba de Jarque-Bera indica que los residuos tienen una distribución razonablemente normal.
Ventana de 28:</p>
<p>Las métricas de error son las más elevadas entre todas las ventanas, lo que sugiere un ajuste poco preciso en el conjunto de pruebas.
El ( R^2 ) sigue siendo negativo y bajo, lo que refuerza la conclusión de un ajuste deficiente.
La prueba de Ljung-Box rechaza la independencia de los residuos, lo que señala autocorrelación y posibles problemas en el modelo.
La prueba de Jarque-Bera no rechaza la normalidad, lo que indica que, a pesar de la autocorrelación, los residuos no presentan una desviación significativa respecto a la normalidad en su distribución.
En resumen, los tamaños de ventana más pequeños tienden a generar mejores resultados en las métricas de error, sugiriendo un ajuste más preciso. Sin embargo, el modelo evidencia limitaciones en su capacidad explicativa en el conjunto de prueba.</p>
</section>
<section id="simple-exponential-smoothing-statsmodels">
<h3>Simple Exponential Smoothing (Statsmodels)<a class="headerlink" href="#simple-exponential-smoothing-statsmodels" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ses_optimizer_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>

    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="n">ses_model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ses_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
            <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mae</span>          

    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="k">def</span> <span class="nf">ses_model_tuning_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    
    <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="c1">#best_alpha, best_mae = ses_optimizer_stat(train, val, alphas, step=step)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">ses_optimizer_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>   
        <span class="c1">#return y_pred, final_model, residuals </span>
    <span class="k">return</span> <span class="n">best_alpha</span> 

<span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">ses_model_tuning_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">})</span>
    
<span class="c1"># ENTRENAMIENTO</span>

<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE_STAT&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  SSE_STAT       7  32912.037778  1.237673e+09  13415.818966   

               RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  35180.578012 -4.381039                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/6b461b23db65e3f0149b7556bc3c8c467b80a157e22f2b935543480447fa6db8.png" src="_images/6b461b23db65e3f0149b7556bc3c8c467b80a157e22f2b935543480447fa6db8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/7cc75afcaa332276908c7276d0de942557ee4881f06d4038387866f20f760602.png" src="_images/7cc75afcaa332276908c7276d0de942557ee4881f06d4038387866f20f760602.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" src="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  SSE_STAT      14  32912.037778  1.237673e+09  13415.818966   

               RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  35180.578012 -4.381039                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/6b461b23db65e3f0149b7556bc3c8c467b80a157e22f2b935543480447fa6db8.png" src="_images/6b461b23db65e3f0149b7556bc3c8c467b80a157e22f2b935543480447fa6db8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/7cc75afcaa332276908c7276d0de942557ee4881f06d4038387866f20f760602.png" src="_images/7cc75afcaa332276908c7276d0de942557ee4881f06d4038387866f20f760602.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" src="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  SSE_STAT      21  32912.037778  1.237673e+09  13415.818966   

               RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  35180.578012 -4.381039                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/6b461b23db65e3f0149b7556bc3c8c467b80a157e22f2b935543480447fa6db8.png" src="_images/6b461b23db65e3f0149b7556bc3c8c467b80a157e22f2b935543480447fa6db8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/7cc75afcaa332276908c7276d0de942557ee4881f06d4038387866f20f760602.png" src="_images/7cc75afcaa332276908c7276d0de942557ee4881f06d4038387866f20f760602.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" src="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  SSE_STAT      28  32912.037778  1.237673e+09  13415.818966   

               RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  35180.578012 -4.381039                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/6b461b23db65e3f0149b7556bc3c8c467b80a157e22f2b935543480447fa6db8.png" src="_images/6b461b23db65e3f0149b7556bc3c8c467b80a157e22f2b935543480447fa6db8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/7cc75afcaa332276908c7276d0de942557ee4881f06d4038387866f20f760602.png" src="_images/7cc75afcaa332276908c7276d0de942557ee4881f06d4038387866f20f760602.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" src="_images/c7f82caef24a4d66d46636f8dc8d75d7184ad329123720a3bc521c7775f93cdf.png" />
</div>
</div>
<p>Las métricas de error (MAE, MSE, MAPE, RMSE) presentan valores altos, lo que señala un significativo nivel de inexactitud en las predicciones. Esto indica que el modelo no logra captar adecuadamente la estructura inherente a los datos del conjunto de entrenamiento.</p>
<p><em>Evaluaciones de Diagnóstico de Residuos:</em></p>
<ul class="simple">
<li><p>Ljung-Box: La hipótesis nula de independencia se rechaza en todos los rezagos analizados, lo que sugiere la presencia de una autocorrelación notable en los residuos. Esto indica que el modelo no ha logrado identificar las relaciones temporales, lo que se traduce en residuos con patrones no incluidos.</p></li>
<li><p>Jarque-Bera: La prueba de normalidad resulta desfavorable, sugiriendo que los residuos no se distribuyen de forma normal, lo que puede comprometer la fiabilidad del modelo en la estimación de intervalos de predicción.</p></li>
</ul>
<p><strong>Los gráficos producidos proporcionan información adicional sobre el comportamiento de los residuos generados por el modelo:</strong></p>
<ul class="simple">
<li><p>Serie Temporal de Residuos: La representación gráfica de la serie temporal ilustra fluctuaciones y variaciones notables en los residuos a lo largo del tiempo. En varios momentos, se aprecian desviaciones drásticas, lo que indica la existencia de eventos o patrones que el modelo de suavización exponencial no consigue capturar adecuadamente.</p></li>
<li><p>Gráfico Q-Q de Residuos: Este gráfico muestra que los residuos se apartan significativamente de la línea de referencia teórica de normalidad, especialmente en los extremos. Esto respalda la conclusión de la prueba de Jarque-Bera, confirmando que los residuos no siguen una distribución normal.</p></li>
<li><p>Función de Autocorrelación (ACF) de Residuos: La ACF revela una clara inclinación hacia la autocorrelación positiva en los primeros rezagos, la cual disminuye de manera gradual. Sin embargo, ciertos picos que caen fuera de los intervalos de confianza sugieren que permanecen patrones en los residuos que no fueron adecuadamente modelados.</p></li>
</ul>
<p>En conclusión, los resultados evidencian que el modelo de suavización exponencial tiene limitaciones en su capacidad para capturar completamente los patrones temporales de la serie. Esto se manifiesta en los altos niveles de error y en las fallas de los tests de independencia y normalidad aplicados a los residuos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TEST</span>

<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">to_train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE_STAT&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window          MAE           MSE      MAPE         RMSE  \
test  SSE_STAT       7  2886.010934  1.268968e+07  0.061433  3562.257778   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -1.910062           0.009841               0.6969  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window         MAE           MSE      MAPE         RMSE  \
test  SSE_STAT      14  3247.08804  1.112182e+07  0.062885  3334.939791   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -18.233834            0.47835             0.137768  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window          MAE           MSE      MAPE          RMSE  \
test  SSE_STAT      21  7990.938124  1.035984e+08  0.123411  10178.331907   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -1.307795       4.509490e-10             0.328286  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window           MAE           MSE      MAPE         RMSE  \
test  SSE_STAT      28  14101.769432  2.170913e+08  0.210821  14734.01718   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -10.907573           0.000002             0.427015  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ventana de 7:</p></li>
</ul>
<p>Métricas de Error: Los errores son moderados, evidenciando un MAPE bajo, lo que sugiere un nivel de error relativo aceptable.
R²: Presenta un valor negativo, lo que indica que el modelo no se adapta bien a los datos.
Evaluaciones de Diagnóstico: La prueba de Ljung-Box indica la presencia de autocorrelación en los residuos, mientras que Jarque-Bera muestra que los residuos son aproximadamente normales.</p>
<ul class="simple">
<li><p>Ventana de 14:</p></li>
</ul>
<p>Métricas de Error: Se nota una mejora en las métricas, con un MAPE bajo y una disminución en los errores absolutos.
R²: El valor es negativo y se aproxima a cero, lo que sugiere un ajuste inadecuado.
Evaluaciones de Diagnóstico: La prueba de Ljung-Box no indica autocorrelación significativa, y Jarque-Bera señala que los residuos están próximos a una distribución normal.</p>
<ul class="simple">
<li><p>Ventana de 21:</p></li>
</ul>
<p>Métricas de Error: Los errores han aumentado considerablemente, resultando en un MAPE relativamente alto.
R²: Continúa siendo negativo, lo que es indicativo de un mal ajuste.
Evaluaciones de Diagnóstico: La prueba de Ljung-Box revela autocorrelación significativa en los residuos, mientras que Jarque-Bera no rechaza la normalidad de estos.</p>
<ul class="simple">
<li><p>Ventana de 28:</p></li>
</ul>
<p>Métricas de Error: Los errores son elevados, lo que refleja las dificultades del modelo para capturar adecuadamente la estructura en esta ventana de datos.
R²: Se mantiene en un valor negativo, indicando un ajuste deficiente.
Evaluaciones de Diagnóstico: Ljung-Box sugiere una fuerte autocorrelación, mientras que Jarque-Bera indica que los residuos son aproximadamente normales.</p>
<p>En general, el modelo presenta un ajuste insatisfactorio a lo largo de las diferentes ventanas de datos, con errores altos y evidencia de autocorrelación en los residuos, especialmente en las ventanas más amplias. Aunque los residuos se acercan a la normalidad, sería beneficioso considerar ajustes adicionales o la implementación de métodos alternativos para mejorar la precisión y capturar de manera más efectiva la estructura de los datos.</p>
</section>
<section id="double-exponencial-smoothing">
<h3>Double Exponencial Smoothing<a class="headerlink" href="#double-exponencial-smoothing" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">doublesmooth_statsmodels</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Configurar el modelo Holt con tendencia lineal (no estacional)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Holt</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">damped_trend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="n">initialization_method</span><span class="p">)</span>
    
    <span class="c1"># Ajustar el modelo con los parámetros alpha y beta</span>
    <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">smoothing_slope</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># Obtener los valores suavizados (fitted values)</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">fittedvalues</span>
    <span class="k">return</span> <span class="n">ytilde</span><span class="p">,</span> <span class="n">fitted_model</span>

<span class="c1"># Función para generar predicciones basadas en DES usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="c1"># Aplicar DES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span><span class="p">,</span> <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">doublesmooth_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">forecast</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">val_length</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador DES con verificación de datos usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_optimizer_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="n">betas</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="p">)</span>
                <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mae</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Manejar posibles excepciones, por ejemplo, parámetros no válidos</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error con alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo DES usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_model_tuning_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">des_optimizer_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span>

<span class="c1"># ENTRENAMIENTO </span>

<span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span> <span class="o">=</span> <span class="n">des_model_tuning_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span> <span class="p">:</span> <span class="n">best_beta</span><span class="p">})</span>
    
<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;DSE&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE        MAPE          RMSE  \
train   DSE       7  44415.930974  2.092572e+09  13907.2858  45744.639238   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
train -8.097888                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/d1c28e739c576b6d97a2cbe2c4ca1516e2d7d14a6c9f0f9b63c988bcf6b8d29e.png" src="_images/d1c28e739c576b6d97a2cbe2c4ca1516e2d7d14a6c9f0f9b63c988bcf6b8d29e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/51aaa9cc29fcb7e0d56578548a410702c503ef6c1ca4878fcbe25b477f9f93ac.png" src="_images/51aaa9cc29fcb7e0d56578548a410702c503ef6c1ca4878fcbe25b477f9f93ac.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/0ef2082ac0f7f818ab548045ac1abc0fe5dc7bf4f50bd1bd355e8200a92f465e.png" src="_images/0ef2082ac0f7f818ab548045ac1abc0fe5dc7bf4f50bd1bd355e8200a92f465e.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window            MAE           MSE          MAPE         RMSE  \
train   DSE      14  857320.849944  9.515629e+11  26552.205167  975480.8476   

                R2  Ljung-Box p-value  Jarque-Bera p-value  
train -4136.115605                0.0         2.910762e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/fff52107fe726c71b32fcb535e46af6dafba93effd74915a6e2849e4ca42dd93.png" src="_images/fff52107fe726c71b32fcb535e46af6dafba93effd74915a6e2849e4ca42dd93.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/401047ba7509dd2a437941a1b46bed334b4644cc25b80eb6ddc9907cd08d9b8c.png" src="_images/401047ba7509dd2a437941a1b46bed334b4644cc25b80eb6ddc9907cd08d9b8c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/732075d40da0a3c84136e88d3068d11e8dbeb8054cdb0f374bfdd5324d725e2c.png" src="_images/732075d40da0a3c84136e88d3068d11e8dbeb8054cdb0f374bfdd5324d725e2c.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE          MAPE          RMSE  \
train   DSE      21  1.342343e+06  2.358015e+12  34081.410632  1.535583e+06   

                 R2  Ljung-Box p-value  Jarque-Bera p-value  
train -10250.954264                0.0         1.371897e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/fe784e8803fd4d960dd05d82baf82c7cf15e251e9a102039129734eec9c7e7b5.png" src="_images/fe784e8803fd4d960dd05d82baf82c7cf15e251e9a102039129734eec9c7e7b5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/c6dee147ed38ddd4279cf243930aadefcdc9cf945c9d7d57689d07bb3bfe2b4a.png" src="_images/c6dee147ed38ddd4279cf243930aadefcdc9cf945c9d7d57689d07bb3bfe2b4a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/24ee4ac1beefe30f2cd349394c072bebc87ef12640b3715c99757ecb21130794.png" src="_images/24ee4ac1beefe30f2cd349394c072bebc87ef12640b3715c99757ecb21130794.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE          MAPE          RMSE  \
train   DSE      28  1.162101e+06  1.761947e+12  31328.711364  1.327384e+06   

                R2  Ljung-Box p-value  Jarque-Bera p-value  
train -7659.429127                0.0         1.680025e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/6bc50daf7cabcf89a37cb3ac99b7084ab26af9562a9371d3f80116e6f91ad114.png" src="_images/6bc50daf7cabcf89a37cb3ac99b7084ab26af9562a9371d3f80116e6f91ad114.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/0f59e4bca3b20f6858ef9ec2ef4f11556a3c25b9ed82500683d0f46010415281.png" src="_images/0f59e4bca3b20f6858ef9ec2ef4f11556a3c25b9ed82500683d0f46010415281.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/f653567f68ecec0686ed634298a6a2b5ea2831238d8e479c2ecaa771caef7b02.png" src="_images/f653567f68ecec0686ed634298a6a2b5ea2831238d8e479c2ecaa771caef7b02.png" />
</div>
</div>
<ul class="simple">
<li><p>Ventana de 7:</p></li>
</ul>
<p>Métricas de Error: Los valores de error son elevados, lo que sugiere un mal ajuste del modelo.
Pruebas de Diagnóstico: La prueba de Ljung-Box indica la presencia de autocorrelación significativa en los residuos, mientras que Jarque-Bera rechaza la hipótesis de normalidad, lo que sugiere una distribución no normal caracterizada por colas pesadas.</p>
<ul class="simple">
<li><p>Ventana de 14:</p></li>
</ul>
<p>Métricas de Error: Se observan errores elevados, lo que indica que el modelo enfrenta dificultades para identificar patrones en los datos.
Pruebas de Diagnóstico: Los residuos muestran tanto autocorrelación como falta de normalidad, con colas pronunciadas, lo que asegura que el modelo no puede capturar adecuadamente las dependencias temporales.</p>
<ul class="simple">
<li><p>Ventana de 21:</p></li>
</ul>
<p>Métricas de Error: Aunque el error relativo se mantiene, las métricas de error absoluto continúan siendo altas.
Pruebas de Diagnóstico: Tanto Ljung-Box como Jarque-Bera indican que los residuos no son independientes ni normales, sugiriendo patrones persistentes que no han sido modelados.</p>
<ul class="simple">
<li><p>Ventana de 28:</p></li>
</ul>
<p>Métricas de Error: Los errores incrementan, lo que evidencia que el modelo no logra captar la variabilidad en los datos.
Pruebas de Diagnóstico: Los residuos presentan una clara autocorrelación y no cumplen con la normalidad, lo que restringe la capacidad predictiva del modelo.</p>
<p>El modelo de doble suavización exponencial muestra un ajuste limitado dentro del conjunto de entrenamiento, ya que los residuos son autocorrelacionados y no normales en todas las ventanas de análisis. Esto sugiere que el modelo no captura adecuadamente las dependencias temporales ni la estructura presente en los datos, por lo que sería recomendable explorar alternativas o realizar ajustes para mejorar el rendimiento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TEST</span>

<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window         MAE           MSE      MAPE         RMSE        R2  \
test   SSE       7  4429.27252  2.903800e+07  0.094425  5388.692272 -5.659144   

      Ljung-Box p-value  Jarque-Bera p-value  
test            0.01278             0.724593  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      14  3103.528529  1.668454e+07  0.060248  4084.671185   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -27.85387           0.000463             0.531203  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      21  6800.915479  6.735785e+07  0.106852  8207.183047   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -0.500487       5.769270e-10             0.326351  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window           MAE           MSE      MAPE          RMSE  \
test   SSE      28  12214.580067  1.639685e+08  0.182636  12805.016742   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -7.993758           0.000018             0.816668  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ventana de 7:</p></li>
</ul>
<p>Métricas de Error: Los indicadores de error (MAE, MSE, RMSE) son moderados, aunque el MAPE es alto, lo que sugiere variaciones importantes en el error relativo.
Pruebas de Diagnóstico: La prueba de Ljung-Box indica la presencia de autocorrelación en los residuos, mientras que Jarque-Bera no rechaza la normalidad, sugiriendo que los residuos se comportan de manera cercana a la normalidad.</p>
<ul class="simple">
<li><p>Ventana de 14:</p></li>
</ul>
<p>Métricas de Error: Los errores absolutos son relativamente bajos y el MAPE se mantiene en niveles aceptables, indicando un mejor ajuste en este intervalo.
Pruebas de Diagnóstico: Según Ljung-Box, no se detecta autocorrelación significativa en los residuos, y la prueba de normalidad no es rechazada, sugiriendo que los residuos son independientes y normales.</p>
<ul class="simple">
<li><p>Ventana de 21:</p></li>
</ul>
<p>Métricas de Error: Tanto los errores absolutos como los relativos experimentan un aumento considerable, evidenciando las limitaciones del modelo en esta ventana.
Pruebas de Diagnóstico: La autocorrelación en los residuos sigue siendo significativa, y la prueba de Jarque-Bera no rechaza la hipótesis de normalidad.</p>
<ul class="simple">
<li><p>Ventana de 28:</p></li>
</ul>
<p>Métricas de Error: Los niveles de error son altos, lo que indica un rendimiento deficiente en la predicción de los datos dentro de esta ventana amplia.
Pruebas de Diagnóstico: La prueba Ljung-Box revela una fuerte autocorrelación en los residuos, aunque Jarque-Bera muestra que la normalidad se aproxima.</p>
<p>El modelo de doble suavización exponencial ha mostrado un rendimiento razonable en desplazamientos cortos (7 y 14), donde los errores son menores y los residuos se comportan de manera independiente y normal. Sin embargo, se presentan dificultades para capturar las características de los datos en ventanas más amplias (21 y 28), con un aumento notable en los errores y evidencia de autocorrelación en los residuos, lo que indica una disminución en la precisión a medida que se amplían los horizontes de predicción.</p>
</section>
<section id="double-exponencial-smoothing-con-libreria">
<h3>Double Exponencial Smoothing (Con librería)<a class="headerlink" href="#double-exponencial-smoothing-con-libreria" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">doublesmooth_statsmodels</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Configurar el modelo Holt con tendencia lineal (no estacional)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Holt</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">damped_trend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="n">initialization_method</span><span class="p">)</span>
    
    <span class="c1"># Ajustar el modelo con los parámetros alpha y beta</span>
    <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">smoothing_slope</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># Obtener los valores suavizados (fitted values)</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">fittedvalues</span>
    <span class="k">return</span> <span class="n">ytilde</span><span class="p">,</span> <span class="n">fitted_model</span>

<span class="c1"># Función para generar predicciones basadas en DES usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="c1"># Aplicar DES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span><span class="p">,</span> <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">doublesmooth_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">forecast</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">val_length</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador DES con verificación de datos usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_optimizer_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="n">betas</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="p">)</span>
                <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mae</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Manejar posibles excepciones, por ejemplo, parámetros no válidos</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error con alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo DES usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_model_tuning_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">des_optimizer_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span>

<span class="c1"># ENTRENAMIENTO</span>

<span class="n">bbest_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span> <span class="o">=</span> <span class="n">des_model_tuning_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span> <span class="p">:</span> <span class="n">best_beta</span><span class="p">})</span>

<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;DSE_STAT&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window            MAE           MSE         MAPE  \
train  DSE_STAT       7  487944.125128  3.015767e+11  20781.79046   

                RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  549159.997596 -1310.166823                0.0         1.605789e-63  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/43fd9bddcbe19040ae5e07beeccbc9abc438d1ee7d62f3f4d055ed26839407cf.png" src="_images/43fd9bddcbe19040ae5e07beeccbc9abc438d1ee7d62f3f4d055ed26839407cf.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/a25df339aed67d99fb8c13bf5aaacb4479597b8732337a8d11f3ae17868de54d.png" src="_images/a25df339aed67d99fb8c13bf5aaacb4479597b8732337a8d11f3ae17868de54d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/f681b01fd7b83078c4b5675773ae7d3f867df1f2749d2f7198351920157dc991.png" src="_images/f681b01fd7b83078c4b5675773ae7d3f867df1f2749d2f7198351920157dc991.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window            MAE           MSE         MAPE  \
train  DSE_STAT       7  487944.125128  3.015767e+11  20781.79046   

                RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  549159.997596 -1310.166823                0.0         1.605789e-63  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/43fd9bddcbe19040ae5e07beeccbc9abc438d1ee7d62f3f4d055ed26839407cf.png" src="_images/43fd9bddcbe19040ae5e07beeccbc9abc438d1ee7d62f3f4d055ed26839407cf.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/a25df339aed67d99fb8c13bf5aaacb4479597b8732337a8d11f3ae17868de54d.png" src="_images/a25df339aed67d99fb8c13bf5aaacb4479597b8732337a8d11f3ae17868de54d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/f681b01fd7b83078c4b5675773ae7d3f867df1f2749d2f7198351920157dc991.png" src="_images/f681b01fd7b83078c4b5675773ae7d3f867df1f2749d2f7198351920157dc991.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window            MAE           MSE          MAPE  \
train  DSE_STAT      14  809385.361806  8.467865e+11  25725.029648   

                RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  920210.052456 -3680.578875                0.0         3.302464e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/fe9f1d881ae4949da7101fc7a327b70576c5982baa44c7819b67e53c535176c3.png" src="_images/fe9f1d881ae4949da7101fc7a327b70576c5982baa44c7819b67e53c535176c3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/6eb237f2f8f9f13bc4d6f7d31da1bb7293174b35c973a63c29903df878b10420.png" src="_images/6eb237f2f8f9f13bc4d6f7d31da1bb7293174b35c973a63c29903df878b10420.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/bef7242ab8f842a20e29932bded3eb298c778169fed2b82840d43101e85158da.png" src="_images/bef7242ab8f842a20e29932bded3eb298c778169fed2b82840d43101e85158da.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  DSE_STAT      21  1.297544e+06  2.201464e+12  33507.100692   

               RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  1.483733e+06 -9570.317803                0.0         1.435372e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/0522c0e90e627f15b7212c58e1e61e82d88477644c612114f1b050b1169044be.png" src="_images/0522c0e90e627f15b7212c58e1e61e82d88477644c612114f1b050b1169044be.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/38e2281c99ff95158fca666ebe8190b341240598862c56c290357b2b7953c44e.png" src="_images/38e2281c99ff95158fca666ebe8190b341240598862c56c290357b2b7953c44e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/a88b089bd72c0c7051fa57f25ab96c9de7334815fb292c95c9f363006e572215.png" src="_images/a88b089bd72c0c7051fa57f25ab96c9de7334815fb292c95c9f363006e572215.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  DSE_STAT      28  1.184464e+06  1.830934e+12  31773.448247   

               RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  1.353120e+06 -7959.361016                0.0         1.633250e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/3d3a5015c4e65a95e064d7d0d343473a9e177d1df7a68ae38104455c358bc6b8.png" src="_images/3d3a5015c4e65a95e064d7d0d343473a9e177d1df7a68ae38104455c358bc6b8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/3940654e43386cddaa2f24c58d9b74273898d8f0140d88f8a4b7c40f0576b844.png" src="_images/3940654e43386cddaa2f24c58d9b74273898d8f0140d88f8a4b7c40f0576b844.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/977544faf38a35cf041f84b9f45fe14f86901b604a49e53e4843e0be1ce2c1a7.png" src="_images/977544faf38a35cf041f84b9f45fe14f86901b604a49e53e4843e0be1ce2c1a7.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window            MAE           MSE         MAPE  \
train  DSE_STAT       7  487944.125128  3.015767e+11  20781.79046   

                RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  549159.997596 -1310.166823                0.0         1.605789e-63  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/43fd9bddcbe19040ae5e07beeccbc9abc438d1ee7d62f3f4d055ed26839407cf.png" src="_images/43fd9bddcbe19040ae5e07beeccbc9abc438d1ee7d62f3f4d055ed26839407cf.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/a25df339aed67d99fb8c13bf5aaacb4479597b8732337a8d11f3ae17868de54d.png" src="_images/a25df339aed67d99fb8c13bf5aaacb4479597b8732337a8d11f3ae17868de54d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/f681b01fd7b83078c4b5675773ae7d3f867df1f2749d2f7198351920157dc991.png" src="_images/f681b01fd7b83078c4b5675773ae7d3f867df1f2749d2f7198351920157dc991.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window            MAE           MSE          MAPE  \
train  DSE_STAT      14  809385.361806  8.467865e+11  25725.029648   

                RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  920210.052456 -3680.578875                0.0         3.302464e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/fe9f1d881ae4949da7101fc7a327b70576c5982baa44c7819b67e53c535176c3.png" src="_images/fe9f1d881ae4949da7101fc7a327b70576c5982baa44c7819b67e53c535176c3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/6eb237f2f8f9f13bc4d6f7d31da1bb7293174b35c973a63c29903df878b10420.png" src="_images/6eb237f2f8f9f13bc4d6f7d31da1bb7293174b35c973a63c29903df878b10420.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/bef7242ab8f842a20e29932bded3eb298c778169fed2b82840d43101e85158da.png" src="_images/bef7242ab8f842a20e29932bded3eb298c778169fed2b82840d43101e85158da.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  DSE_STAT      21  1.297544e+06  2.201464e+12  33507.100692   

               RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  1.483733e+06 -9570.317803                0.0         1.435372e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/0522c0e90e627f15b7212c58e1e61e82d88477644c612114f1b050b1169044be.png" src="_images/0522c0e90e627f15b7212c58e1e61e82d88477644c612114f1b050b1169044be.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/38e2281c99ff95158fca666ebe8190b341240598862c56c290357b2b7953c44e.png" src="_images/38e2281c99ff95158fca666ebe8190b341240598862c56c290357b2b7953c44e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/a88b089bd72c0c7051fa57f25ab96c9de7334815fb292c95c9f363006e572215.png" src="_images/a88b089bd72c0c7051fa57f25ab96c9de7334815fb292c95c9f363006e572215.png" />
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  DSE_STAT      28  1.184464e+06  1.830934e+12  31773.448247   

               RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  1.353120e+06 -7959.361016                0.0         1.633250e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="_images/3d3a5015c4e65a95e064d7d0d343473a9e177d1df7a68ae38104455c358bc6b8.png" src="_images/3d3a5015c4e65a95e064d7d0d343473a9e177d1df7a68ae38104455c358bc6b8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="_images/3940654e43386cddaa2f24c58d9b74273898d8f0140d88f8a4b7c40f0576b844.png" src="_images/3940654e43386cddaa2f24c58d9b74273898d8f0140d88f8a4b7c40f0576b844.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="_images/977544faf38a35cf041f84b9f45fe14f86901b604a49e53e4843e0be1ce2c1a7.png" src="_images/977544faf38a35cf041f84b9f45fe14f86901b604a49e53e4843e0be1ce2c1a7.png" />
</div>
</div>
<ul class="simple">
<li><p>Ventana de 7:</p></li>
</ul>
<p>Métricas de Error: Las métricas reflejan errores altos, lo que indica que el modelo tiene dificultades para identificar adecuadamente los patrones en este intervalo.
Pruebas de Diagnóstico: La prueba de Ljung-Box rechaza la hipótesis de independencia de los residuos en todos los rezagos, mientras que Jarque-Bera también rechaza la normalidad, sugiriendo que los residuos son autocorrelacionados y presentan colas pesadas.</p>
<ul class="simple">
<li><p>Ventana de 14:</p></li>
</ul>
<p>Métricas de Error: Los errores siguen siendo altos, corroborando que el modelo continúa enfrentando problemas de ajuste.
Pruebas de Diagnóstico: La autocorrelación se mantiene significativa en todos los rezagos, y la prueba de Jarque-Bera evidencia la no normalidad de los residuos.</p>
<ul class="simple">
<li><p>Ventana de 21:</p></li>
</ul>
<p>Métricas de Error: Los niveles de error permanecen altos, alineándose con las dificultades de ajuste observadas en ventanas anteriores.
Pruebas de Diagnóstico: La autocorrelación y la falta de normalidad continúan, sugiriendo que los residuos contienen patrones no capturados y colas pesadas.</p>
<ul class="simple">
<li><p>Ventana de 28:</p></li>
</ul>
<p>Métricas de Error: Observamos errores considerablemente altos, confirmando que el modelo no se ajusta bien a horizontes de predicción más amplios.
Pruebas de Diagnóstico: Los residuos son tanto autocorrelacionados como no normales, lo que limita la fiabilidad de las predicciones del modelo en esta configuración.</p>
<p>La aplicación de la doble suavización exponencial utilizando statsmodels revela limitaciones significativas en el conjunto de entrenamiento. En todas las ventanas analizadas, los residuos presentan autocorrelación y falta de normalidad, lo que indica que el modelo no logra capturar de manera efectiva la estructura de la serie temporal. Esto sugiere la necesidad de considerar modelos alternativos o realizar ajustes adicionales.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="test">
<h1>TEST<a class="headerlink" href="#test" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE     MAPE         RMSE        R2  \
test   SSE       7  4158.423374  2.481376e+07  0.08879  4981.341399 -4.690419   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.011882             0.717091  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE     MAPE         RMSE        R2  \
test   SSE       7  4158.423374  2.481376e+07  0.08879  4981.341399 -4.690419   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.011882             0.717091  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      14  3457.452554  2.051994e+07  0.067113  4529.894002   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -34.486727           0.000465             0.536057  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      21  5528.899307  4.082846e+07  0.088226  6389.714794   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test  0.090491       1.314406e-09             0.331899  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window           MAE           MSE      MAPE          RMSE  \
test   SSE      28  16383.563776  2.918174e+08  0.245122  17082.664843   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -15.006344       1.080732e-07             0.209344  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE     MAPE         RMSE        R2  \
test   SSE       7  4158.423374  2.481376e+07  0.08879  4981.341399 -4.690419   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.011882             0.717091  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      14  3457.452554  2.051994e+07  0.067113  4529.894002   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -34.486727           0.000465             0.536057  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      21  5528.899307  4.082846e+07  0.088226  6389.714794   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test  0.090491       1.314406e-09             0.331899  
</pre></div>
</div>
<div class="output text_html"><p style="color: black; font-size: 18px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: black; font-size: 18px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window           MAE           MSE      MAPE          RMSE  \
test   SSE      28  16383.563776  2.918174e+08  0.245122  17082.664843   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -15.006344       1.080732e-07             0.209344  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ventana de 21:</p></li>
</ul>
<p>Pruebas de Diagnóstico: La prueba de Ljung-Box indica una autocorrelación significativa en los residuos, lo que sugiere que el modelo no ha capturado completamente las dinámicas temporales.
Métricas de Error: Los errores, tanto absolutos como relativos, muestran un aumento notable, reflejando las dificultades del modelo en este rango más amplio.</p>
<ul class="simple">
<li><p>Ventana de 28:</p></li>
</ul>
<p>Métricas de Error: Se observa que los niveles de error son elevados, indicando que el modelo tiene problemas para representar adecuadamente la estructura de los datos en este intervalo.
Pruebas de Diagnóstico: La autocorrelación en los residuos sigue siendo evidente de acuerdo con la prueba de Ljung-Box, mientras que Jarque-Bera sugiere que los residuos son aproximadamente normales.</p>
<ul class="simple">
<li><p>Ventana de 7:</p></li>
</ul>
<p>Pruebas de Diagnóstico: La prueba de Jarque-Bera no rechaza la normalidad de los residuos, a pesar de que la prueba de Ljung-Box indica que hay autocorrelación residual presente.
Métricas de Error: Aunque el MAE y el RMSE son moderados, el MAPE se encuentra en un nivel relativamente alto, lo que sugiere una considerable variabilidad en el error relativo.</p>
<ul class="simple">
<li><p>Ventana de 14:</p></li>
</ul>
<p>Métricas de Error: Las métricas de error absolutas, como el MAE y el RMSE, son más bajas, junto con un MAPE reducido, lo que indica una mejora en el ajuste del modelo.
Pruebas de Diagnóstico: Ljung-Box no muestra evidencia de autocorrelación significativa en los residuos, lo que es favorable. Además, se aprecia que los residuos son aproximadamente normales.</p>
<p>La implementación de la doble suavización exponencial en el conjunto de prueba revela un rendimiento satisfactorio en ventanas cortas (7 y 14), donde los residuos presentan características cercanas a la normalidad y no se observa autocorrelación significativa. Sin embargo, en ventanas de mayor tamaño (21 y 28), el modelo evidencia una disminución en su precisión, junto con un aumento en los errores.</p>
<section id="arima-sin-rolling">
<h2>Arima (Sin Rolling)<a class="headerlink" href="#arima-sin-rolling" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Serie original</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeserie</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">timeserie</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Series&#39;</span><span class="p">)</span>
<span class="c1">#axes[0, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[0, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="c1"># Primera diferencia</span>
<span class="n">first_diff</span> <span class="o">=</span> <span class="n">timeserie</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">first_diff</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">first_diff</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;1st Order Differencing&#39;</span><span class="p">)</span>
<span class="c1">#axes[1, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[1, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">first_diff</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="c1"># Segunda diferencia</span>
<span class="n">second_diff</span> <span class="o">=</span> <span class="n">timeserie</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">second_diff</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">second_diff</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;2nd Order Differencing&#39;</span><span class="p">)</span>
<span class="c1">#axes[2, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[2, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">second_diff</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/991715f2d25cc9ada34053ede7dfced888ffd9b377caca5295db95dd9db01993.png" src="_images/991715f2d25cc9ada34053ede7dfced888ffd9b377caca5295db95dd9db01993.png" />
</div>
</div>
<p><em>Primera Diferenciación:</em></p>
<p>Al aplicar la primera diferencia a la serie, se observa una reducción significativa de la tendencia y se estabiliza parcialmente la variabilidad. Sin embargo, persiste cierta variabilidad en los valores, particularmente en las fluctuaciones de mayor amplitud. La función de autocorrelación (ACF) tras la primera diferenciación indica que la mayoría de las autocorrelaciones han sido eliminadas, aunque aún se perciben algunos picos menores. Esto sugiere una mejora considerable hacia la estacionariedad, aunque todavía podría estar incompleta.</p>
<p>Un modelo como ARIMA(1,1,0) o ARIMA(1,1,1) podría resultar eficaz para capturar la estructura, aunque una segunda diferenciación podría contribuir aún más a la estacionariedad.</p>
<p><em>Serie Original:</em></p>
<p>La serie original revela una tendencia creciente notable, especialmente hacia su final, y presenta una volatilidad que aumenta en los valores altos. La ACF de la serie original es alta y decrece lentamente, lo que implica que la serie no es estacionaria y presenta una dependencia a largo plazo. Esta falta de estacionariedad sugiere que es necesario realizar una diferenciación antes de aplicar un modelo ARIMA.</p>
<p><em>Segunda Diferenciación:</em></p>
<p>Al aplicar una segunda diferenciación, la serie se estabiliza aún más, eliminando prácticamente cualquier tendencia o dependencia observable. La ACF de la serie tras la segunda diferenciación muestra muy poca autocorrelación en todos los rezagos, indicando que la serie ha alcanzado la estacionariedad.
Esto sugiere que un modelo ARIMA(1,2,0) o ARIMA(1,2,1) sería adecuado para modelar esta serie, capturando cualquier dependencia residual después de la segunda diferenciación.</p>
<p>La serie original presenta una tendencia fuerte y no es estacionaria. La primera diferenciación reduce considerablemente esta dependencia, pero la segunda diferenciación parece ser necesaria para lograr una estacionariedad completa. Por lo tanto, un modelo ARIMA con d=2 (segunda diferenciación) es probablemente más apropiado para representar la estructura de esta serie temporal.</p>
<p><strong>DICKEY FULLER</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_result</span> <span class="o">=</span> <span class="n">stattools</span><span class="o">.</span><span class="n">adfuller</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value of the ADF test:&#39;</span><span class="p">,</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>p-value of the ADF test: 0.9426372256091572
</pre></div>
</div>
</div>
</div>
<p>El análisis del test de Dickey-Fuller (ADF) revela un p-valor de 0.9426, lo que supera considerablemente el umbral habitual de 0.05. Esto sugiere que no es posible rechazar la hipótesis nula de no estacionariedad, confirmando que la serie timeserie no presenta estacionariedad.</p>
<p>Este hallazgo indica que es necesario aplicar diferenciación (o una transformación adicional) a la serie para lograr la estacionariedad, que es un requisito fundamental para el uso de un modelo ARIMA. Basado en el análisis previo, podría ser necesario llevar a cabo una primera o incluso una segunda diferenciación antes de proceder a modelar con ARIMA.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="entrenamiento">
<h1>ENTRENAMIENTO<a class="headerlink" href="#entrenamiento" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
   
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ajustar el modelo ARIMA</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        
        <span class="c1"># Generar pronósticos</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">val_length</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">forecast</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al ajustar ARIMA</span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Función para optimizar los hiperparámetros ARIMA</span>
<span class="k">def</span> <span class="nf">arima_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_rng</span><span class="p">,</span> <span class="n">d_rng</span><span class="p">,</span> <span class="n">q_rng</span><span class="p">):</span>
    
    <span class="n">best_mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Iterar sobre todas las combinaciones posibles de (p, d, q)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_rng</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_rng</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Generar pronósticos</span>
                    <span class="n">forecast</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">order</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">forecast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># Calcular el MAE</span>
                        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">forecast</span><span class="p">)</span>
                        
                        <span class="c1"># Actualizar el mejor modelo si es necesario</span>
                        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                            <span class="n">best_mae</span> <span class="o">=</span> <span class="n">mae</span>
                            <span class="n">best_order</span> <span class="o">=</span> <span class="n">order</span>
                            
                            <span class="c1"># Volver a ajustar el modelo para obtener el objeto del mejor modelo</span>
                            <span class="n">best_model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error con orden </span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                    
    <span class="k">return</span> <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span>

<span class="c1"># Función para realizar el tuning del modelo ARIMA</span>
<span class="k">def</span> <span class="nf">arima_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_max</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">d_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
   
    <span class="n">p_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">d_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">q_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span> <span class="o">=</span> <span class="n">arima_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_rng</span><span class="p">,</span> <span class="n">d_rng</span><span class="p">,</span> <span class="n">q_rng</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span>

<span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span> <span class="o">=</span> <span class="n">arima_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span> <span class="p">:</span> <span class="n">best_order</span><span class="p">})</span>
    
<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ventana de 7:</p></li>
</ul>
<p>Métricas de Error: Los errores son moderados, lo que implica un ajuste razonable, aunque hay espacio para optimización.
Pruebas de Diagnóstico: La prueba de Ljung-Box indica que los residuos no son independientes en varios rezagos, lo que señala la existencia de autocorrelación. El gráfico Q-Q sugiere que los residuos se desvían de la normalidad en las colas, mientras que la ACF muestra algún nivel de dependencia.</p>
<ul class="simple">
<li><p>Ventana de 14:</p></li>
</ul>
<p>Métricas de Error: Los errores absolutos experimentan un ligero incremento, lo que indica una mayor dificultad para alcanzar un buen ajuste.
Pruebas de Diagnóstico: La autocorrelación significativa en los residuos es destacada por la prueba de Ljung-Box, y el gráfico Q-Q sugiere que los residuos no presentan una normalidad perfecta. La ACF revela patrones de dependencia temporal en los residuos.</p>
<ul class="simple">
<li><p>Ventana de 21:</p></li>
</ul>
<p>Métricas de Error: Los errores se mantienen en niveles consistentes con las ventanas anteriores, aunque siguen siendo elevados.
Pruebas de Diagnóstico: La autocorrelación en los residuos sigue siendo observable, y el gráfico Q-Q vuelve a plantear dudas sobre la normalidad, al mostrar desviaciones en las colas.</p>
<ul class="simple">
<li><p>Ventana de 28:</p></li>
</ul>
<p>Métricas de Error: Los errores permanecen altos, lo que indica las limitaciones del modelo al abordar horizontes de predicción más amplios.
Pruebas de Diagnóstico: Los residuos continúan mostrando autocorrelación significativa y carecen de normalidad, con la ACF sugiriendo dependencia residual y el gráfico Q-Q confirmando desviaciones en las colas.</p>
<p>En el conjunto de entrenamiento, el modelo ARIMA demuestra un rendimiento adecuado en ventanas más cortas (7 y 14), pero evidencia limitaciones en intervalos más extensos (21 y 28), presentando errores altos y residuos que son autocorrelacionados y no normales. Esto sugiere que podría ser beneficioso realizar ajustes adicionales o considerar otro enfoque de modelado para mejorar el desempeño en previsiones a largo plazo.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>TEST<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="c1">#pred = pd.DataFrame(pred, index=range(len(pred)))</span>
    <span class="c1">#pred.index = test.index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ventana de 28:</p></li>
</ul>
<p>Métricas de Error: Se observa un aumento notable en los errores, lo que indica un ajuste deficiente al trabajar con horizontes de predicción más amplios.
Pruebas de Diagnóstico: Los residuos muestran una autocorrelación significativa y son aproximadamente normales, según los resultados de las pruebas.</p>
<ul class="simple">
<li><p>Ventana de 21:</p></li>
</ul>
<p>Métricas de Error: Hay un aumento significativo en los valores absolutos de error (MAE y RMSE), lo que sugiere que el ajuste es menos preciso en este intervalo.
Pruebas de Diagnóstico: La prueba de Ljung-Box revela una autocorrelación significativa en los residuos, mientras que Jarque-Bera confirma que los residuos tienen características normales.</p>
<ul class="simple">
<li><p>Ventana de 14:</p></li>
</ul>
<p>Métricas de Error: Los errores permanecen en niveles bajos, con un MAPE que denota un ajuste relativamente bueno.
Pruebas de Diagnóstico: No se observa autocorrelación significativa en los residuos según Ljung-Box, y la prueba de Jarque-Bera respalda la normalidad de estos.</p>
<ul class="simple">
<li><p>Ventana de 7:</p></li>
</ul>
<p>Métricas de Error: Los errores (MAE, MSE, RMSE) son moderados, mientras que el MAPE indica una variabilidad media en el error relativo.
Pruebas de Diagnóstico: La prueba de Ljung-Box señala la presencia de autocorrelación significativa en los residuos, a pesar de que Jarque-Bera sugiere que los residuos son aproximadamente normales.</p>
<section id="arima-con-rolling">
<h2>Arima (Con Rolling)<a class="headerlink" href="#arima-con-rolling" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="p">)</span>
            <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
            <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LinAlgError at step </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, using last observed value as prediction&quot;</span><span class="p">)</span>
            <span class="n">yhat</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>  <span class="c1"># Puede ser cualquier valor que tenga sentido, como el último observado</span>

        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1">#print(&#39;predicted=%f, expected=%f&#39; % (yhat, obs))</span>

    <span class="k">return</span> <span class="n">predictions</span>

<span class="c1"># ENTRENAMIENTO </span>

<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">to_pred</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">pred</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="n">to_pred</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">),</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA_ROLLING&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: black; font-size: 18px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Métricas de Error:</p></li>
</ul>
<p>El modelo ARIMA en Rolling exhibe niveles bajos de error en el conjunto de entrenamiento, lo que sugiere una alta precisión en el ajuste de los datos históricos.</p>
<ul class="simple">
<li><p>Evaluaciones de Diagnóstico de Residuos:</p></li>
</ul>
<p>Ljung-Box: Esta prueba no permite rechazar la hipótesis nula de independencia de los residuos, lo que indica que no existe autocorrelación significativa y que el modelo ha logrado captar adecuadamente las relaciones temporales.
Jarque-Bera: La prueba sugiere que los residuos aproximadamente siguen una distribución normal, lo que es favorable para la validez de los intervalos de predicción.</p>
<ul class="simple">
<li><p>Análisis Visual de Residuos:</p></li>
</ul>
<p>ACF: La función de autocorrelación de los residuos no presenta picos relevantes en los rezagos, lo que ratifica la independencia temporal de estos.
Q-Q Plot: Los puntos se distribuyen en torno a la línea de referencia, lo que indica que los residuos se asemejan a una distribución normal.
Serie Temporal de Residuos: Los residuos se mantienen alrededor de cero con varianza constante, lo que sugiere homocedasticidad y la ausencia de patrones no registrados.
Conclusión: El modelo ARIMA en Rolling demuestra un desempeño robusto en el conjunto de entrenamiento, caracterizado por errores bajos y residuos que cumplen con las hipótesis fundamentales de independencia, normalidad y homocedasticidad. Estos hallazgos indican que el modelo es adecuado para capturar la estructura temporal de la serie y resulta prometedor para realizar predicciones precisas.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Ejercicio1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Parcial 1 de Machine Learning</p>
      </div>
    </a>
    <a class="right-next"
       href="RNN.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">MODELO RNN</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Modelos estadísticos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definicion-de-librerias-metricas-y-precision-del-modelo">Definición de librerias, métricas y precisión del modelo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pruebas-de-hipotesis-para-independencia-y-normalidad">Pruebas de hipótesis para independencia y normalidad</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento-validacion-y-test">Entrenamiento, Validación y Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carga-y-procesamiento-de-los-datos">Carga y Procesamiento de los Datos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelamiento-y-ajuste">Modelamiento y ajuste</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponential-smoothing-sin-libreria">Simple Exponential Smoothing (Sin Librería)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponential-smoothing-statsmodels">Simple Exponential Smoothing (Statsmodels)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing">Double Exponencial Smoothing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-con-libreria">Double Exponencial Smoothing (Con librería)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#test">TEST</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-sin-rolling">Arima (Sin Rolling)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento">ENTRENAMIENTO</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">TEST</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-con-rolling">Arima (Con Rolling)</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Johana y Claudia
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>